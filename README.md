# Prophit

A personal spending prediction app for 20-somethings. Prophit connects to your bank data, pulls in external signals like weather and local events, and uses a council of LLMs to generate probabilistic daily spending forecasts — so you can actually see where your money's going before it's gone.

Built at **HackEurope** — Risk & Reward track.

---

## Features

### Daily Predictions (Home)
- Weather-aware spending predictions for Dublin, IE
- Probability bars for predicted spend categories (lunch, coffee, drinks, transport)
- Live week-ahead calendar generated by multi-LLM consensus

### Long Horizon Insights
- Job quit runway — circular progress ring showing how long you can survive without income
- Seasonal spending comparison (winter vs summer)
- Monthly spend trajectory with projection line graph

### Spending History & Patterns
- Week / Month / Year toggle
- This week vs last week comparison bars
- Category breakdown donut chart
- Unusual spike alerts

### Scenario Simulator
- "What if I quit my job?" — runway slider
- "Cut eating out by 50%" — savings calculator
- "Move to a cheaper area" — rent comparison
- AI-generated budget tips from real spending patterns

### Weekly Recap
- AI accuracy score (circular indicator)
- Predicted vs actual spend comparison
- Weekly highlights

### Arena (Social Savings)
- Create or join savings arenas with friends
- Place bets on spending behaviour
- Real-time leaderboard and bet resolution
- Auto-settle when savings targets are hit

### Morning Briefing
- Daily voice briefing via ElevenLabs TTS
- Compact widget card with weather, top prediction, and a nudge
- Play button to hear your personalised briefing

### AI Chat
- Conversational financial assistant
- Aware of your spending patterns and predictions
- Context-aware nudges and advice

### Onboarding
- Bank selection (Monzo, Revolut, AIB, Bank of Ireland, Bank of Scotland)
- Guided connect flow with progress steps

---

## Tech Stack

### Frontend
| Layer | Technology |
|---|---|
| Framework | React Native + Expo (SDK 54) |
| Language | TypeScript |
| Navigation | Expo Router (file-based) |
| Charts | react-native-chart-kit + react-native-svg |
| Audio | expo-av (ElevenLabs TTS playback) |
| Auth & DB | Supabase (auth, realtime, CRUD) |
| File handling | expo-document-picker + expo-file-system |

### Backend
| Layer | Technology |
|---|---|
| Runtime | Python (FastAPI + Gradio) |
| LLMs | Claude Haiku 4.5, Gemini 2.5 Flash Lite, GPT-4o Mini |
| Deployment | Vercel |
| Voice | ElevenLabs TTS API |

### Design System (Monzo-inspired)
| Token | Value |
|---|---|
| Primary / CTA | Hot Coral `#FF4F40` |
| Headers / Text | Deep Navy `#112231` |
| Background | Soft White `#F2F8F3` |
| Accent | Deep Teal `#004E60` |
| Accent | Neon Yellow `#C3FF34` |
| Accent | Mid Orange `#FE8B18` |
| Corner radius | 24pt+ |
| Font | Inter / system sans-serif |

---

## Project Structure

```
prophit/
├── frontend/                  # React Native / Expo app
│   ├── app/
│   │   ├── (tabs)/            # Bottom-tab screens
│   │   │   ├── index.tsx      # Home — daily predictions
│   │   │   ├── insights.tsx   # Long horizon insights
│   │   │   ├── history.tsx    # Spending history & patterns
│   │   │   ├── simulator.tsx  # Scenario simulator
│   │   │   ├── arena.tsx      # Social savings arenas
│   │   │   └── profile.tsx    # User profile & stats
│   │   ├── briefing.tsx       # Morning briefing card
│   │   ├── chat.tsx           # AI chat assistant
│   │   ├── onboarding.tsx     # Bank connect flow
│   │   ├── arena-create.tsx   # Create arena
│   │   ├── arena-join.tsx     # Join arena
│   │   ├── arena-detail.tsx   # Arena detail & bets
│   │   └── arena-results.tsx  # Arena results
│   ├── services/
│   │   ├── backendApi.ts      # Gradio API client
│   │   └── chatService.ts     # AI chat service
│   ├── context/
│   │   └── ArenaContext.tsx   # Supabase arena state
│   └── package.json
├── test-backend/              # FastAPI + Gradio backend (local dev)
│   ├── main.py
│   ├── ui.py
│   └── requirements.txt
└── README.md
```

---

## Getting Started

### Prerequisites
- Node.js 18+
- Expo CLI (`npm install -g expo-cli`)
- iOS Simulator / Android Emulator or Expo Go on device

### Frontend Setup

```bash
cd frontend
npm install
```

Create a `.env` file in `frontend/`:
```env
EXPO_PUBLIC_SUPABASE_URL=your_supabase_url
EXPO_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
ELEVENLABS_API_KEY=your_elevenlabs_key
```

Start the app:
```bash
npm start        # Expo dev server
npm run ios      # iOS simulator
npm run android  # Android emulator
```

### Backend Setup (local dev only)

```bash
cd test-backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

Create a `.env` file in `test-backend/`:
```env
ANTHROPIC_API_KEY=your_anthropic_key
GEMINI_API_KEY=your_gemini_key
OPENAI_API_KEY=your_openai_key
```

Run the Gradio UI:
```bash
python ui.py
```

Or run the FastAPI server:
```bash
uvicorn main:app --reload --port 8001
```

---

## Backend API

Production base URL: `https://prophit-ashy.vercel.app`

All endpoints follow the Gradio async pattern:

```typescript
// Step 1: Submit
const { event_id } = await fetch('/gradio_api/call/{endpoint}', {
  method: 'POST',
  body: JSON.stringify({ data: [...args] }),
}).then(r => r.json());

// Step 2: Poll for result (SSE stream)
const text = await fetch(`/gradio_api/call/{endpoint}/${event_id}`).then(r => r.text());
const result = JSON.parse(text.split('\n').find(l => l.startsWith('data: ')).slice(6));
```

### Endpoints

| Endpoint | Input | Output | Used for |
|---|---|---|---|
| `/analyse_uploaded` | Transaction file (JSON/CSV/PDF/TXT) | 3× markdown analyses (Claude, Gemini, OpenAI) | Insights, History screens |
| `/calendar_uploaded` | Transaction file | Week-ahead calendar markdown + JSON predictions | Home screen predictions |
| `/get_tips` | Spending pattern text | AI budget tips (markdown) | Simulator, Chat |
| `/get_runway` | Financial summary text | Income runway analysis (markdown) | Insights runway ring |
| `/_runway_summary_from_file` | Transaction file | Financial summary text | Feed into `/get_runway` |

### Calendar JSON shape

```json
{
  "week_start": "2026-03-01",
  "daily_predictions": [
    {
      "date": "2026-03-02",
      "day": "Monday",
      "predictions": [
        {
          "behavior": "Coffee",
          "likelihood": 83,
          "avg_spend": 5.50,
          "agreed_by": ["claude", "openai"]
        }
      ]
    }
  ]
}
```

---

## How the Multi-LLM Engine Works

1. **File parsing** — transactions enriched with `day_of_week`
2. **Parallel analysis** — Claude, Gemini, and GPT-4o Mini each analyse the full history simultaneously
3. **Pattern detection** — each model identifies recurring spending behaviours by day and category
4. **Consensus calendar** — Claude synthesises all three outputs into a single week-ahead calendar
5. **Deduplication** — duplicate merchants merged, most accurate predictions surfaced

---

## Environment Variables

| Variable | Where | Purpose |
|---|---|---|
| `EXPO_PUBLIC_SUPABASE_URL` | `frontend/.env` | Supabase project URL |
| `EXPO_PUBLIC_SUPABASE_ANON_KEY` | `frontend/.env` | Supabase anon key |
| `ELEVENLABS_API_KEY` | `frontend/.env` | ElevenLabs TTS voice briefings |
| `ANTHROPIC_API_KEY` | `test-backend/.env` | Claude API |
| `GEMINI_API_KEY` | `test-backend/.env` | Gemini API |
| `OPENAI_API_KEY` | `test-backend/.env` | OpenAI API |

Never commit `.env` files — they are in `.gitignore`.
